// EC2 Connection Test - Simple test to verify SCL works with your EC2
// This is a minimal test to ensure everything is working before full deployment

// Configuration for your EC2 instance
mode := "interpret";
setting := "configuration";
super_user := true;
on_error := "rollback";
target := "ec2-user@172.31.7.120";  // Your EC2 private IP

fn main() {
    print("🧪 EC2 Connection Test");
    print("======================");
    print("Target: " + target);
    print("");
    
    // Test 1: Basic connection and system info
    test_connection();
    
    // Test 2: Basic package operations
    test_package_management();
    
    // Test 3: File operations
    test_file_operations();
    
    // Test 4: Service check
    test_service_management();
    
    print("✅ EC2 connection test completed!");
    print_next_steps();
}

fn test_connection() {
    print("🔍 Test 1: Connection and System Analysis");
    print("-----------------------------------------");
    
    // Get system information from EC2
    print("📊 Getting EC2 system information...");
    sysinfo();
    
    print("✅ Connection test passed");
    print("");
}

fn test_package_management() {
    print("📦 Test 2: Package Management");
    print("------------------------------");
    
    // Test package operations
    print("🔄 Testing package update...");
    package("update", "");
    
    print("📋 Testing package installation...");
    package("install", "htop");
    
    print("✅ Package management test passed");
    print("");
}

fn test_file_operations() {
    print("📁 Test 3: File Operations");
    print("---------------------------");
    
    // Test file creation
    print("📝 Testing file creation...");
    create("/tmp/scl_test", "test_file.txt", "644");
    create("/tmp/scl_test", "config.json", "600");
    create("/tmp/scl_test/logs", "app.log", "644");
    
    print("✅ File operations test passed");
    print("");
}

fn test_service_management() {
    print("⚙️ Test 4: Service Management");
    print("------------------------------");
    
    // Test service status checks
    print("🔍 Checking system services...");
    service("status", "sshd");
    
    print("✅ Service management test passed");
    print("");
}

fn print_next_steps() {
    print("🎯 Test Results Summary");
    print("=======================");
    print("");
    print("✅ All tests passed! Your SCL language can:");
    print("   ✓ Connect to EC2 via SSH");
    print("   ✓ Gather system information");
    print("   ✓ Manage packages (yum/dnf)");
    print("   ✓ Create files and directories");
    print("   ✓ Check service status");
    print("");
    print("🚀 Ready for full deployment!");
    print("");
    print("📋 Next steps:");
    print("  1. Run the full deployment script:");
    print("     ./scl examples/ec2_deployment.scl --verbose");
    print("");
    print("  2. Or customize the deployment by editing:");
    print("     examples/ec2_deployment.scl");
    print("");
    print("🧹 Cleanup test files:");
    print("  SSH to EC2 and run: rm -rf /tmp/scl_test");
}
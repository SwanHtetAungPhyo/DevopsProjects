repos:
  - repo: https://github.com/dnephin/pre-commit-golang
    rev: v0.5.1
    hooks:
      # Pulumi Event
      - id: go-vet
        name: Go Vet (Pulumi Event)
        entry: bash -c 'cd infra/pulumi/event && go vet ./... 2>/dev/null || echo "No go files in pulumi event"'
        language: system
        files: ^infra/pulumi/event/
        pass_filenames: false
        always_run: true

      - id: go-mod-tidy
        name: Go Mod Tidy (Pulumi Event)
        entry: bash -c 'cd infra/pulumi/event && go mod tidy -v && git add go.mod go.sum'
        language: system
        files: ^infra/pulumi/event/go\.mod$
        pass_filenames: false
        always_run: false

      # SCL Lang
      - id: go-vet
        name: Go Vet (SCL Lang)
        entry: bash -c 'cd projects/scl/lang && go vet ./... 2>/dev/null || echo "No Go files to vet in scl/lang"'
        language: system
        files: ^projects/scl/lang/
        pass_filenames: false
        always_run: true

      - id: go-mod-tidy
        name: Go Mod Tidy (SCL Lang)
        entry: bash -c 'cd projects/scl/lang && go mod tidy -v && git add go.mod go.sum'
        language: system
        files: ^projects/scl/lang/go\.mod$
        pass_filenames: false
        always_run: false

      # App One
      - id: go-vet
        name: Go Vet (App One)
        entry: bash -c 'cd projects/event-driven/app-one && go vet ./... 2>/dev/null || echo "No Go files to vet in app-one"'
        language: system
        files: ^projects/event-driven/app-one/
        pass_filenames: false
        always_run: true

      - id: go-mod-tidy
        name: Go Mod Tidy (App One)
        entry: bash -c 'cd projects/event-driven/app-one && go mod tidy -v && git add go.mod go.sum'
        language: system
        files: ^projects/event-driven/app-one/go\.mod$
        pass_filenames: false
        always_run: false

      # App Two
      - id: go-vet
        name: Go Vet (App Two)
        entry: bash -c 'cd projects/event-driven/app-two && go vet ./... 2>/dev/null || echo "No Go files to vet in app-two"'
        language: system
        files: ^projects/event-driven/app-two/
        pass_filenames: false
        always_run: true

      - id: go-mod-tidy
        name: Go Mod Tidy (App Two)
        entry: bash -c 'cd projects/event-driven/app-two && go mod tidy -v && git add go.mod go.sum'
        language: system
        files: ^projects/event-driven/app-two/go\.mod$
        pass_filenames: false
        always_run: false

      # App Three
      - id: go-vet
        name: Go Vet (App Three)
        entry: bash -c 'cd projects/event-driven/app-three && go vet ./... 2>/dev/null || echo "No Go files to vet in app-three"'
        language: system
        files: ^projects/event-driven/app-three/
        pass_filenames: false
        always_run: true

      - id: go-mod-tidy
        name: Go Mod Tidy (App Three)
        entry: bash -c 'cd projects/event-driven/app-three && go mod tidy -v && git add go.mod go.sum'
        language: system
        files: ^projects/event-driven/app-three/go\.mod$
        pass_filenames: false
        always_run: false

      # Docker Log Agent
      - id: go-vet
        name: Go Vet (Docker Log Agent)
        entry: bash -c 'cd projects/docker-log-agent && go vet ./... 2>/dev/null || echo "No Go files to vet in docker-log-agent"'
        language: system
        files: ^projects/docker-log-agent/
        pass_filenames: false
        always_run: true

      - id: go-mod-tidy
        name: Go Mod Tidy (Docker Log Agent)
        entry: bash -c 'cd projects/docker-log-agent && go mod tidy -v && git add go.mod go.sum'
        language: system
        files: ^projects/docker-log-agent/go\.mod$
        pass_filenames: false
        always_run: false

  # Security scanning with Gosec
  - repo: local
    hooks:
      - id: gosec-pulumi-event
        name: Gosec Security Scanner (Pulumi Event)
        entry: bash -c 'cd infra/pulumi/event && gosec -exclude-dir=vendor -exclude-generated ./... 2>/dev/null || echo "No Go files to scan"'
        language: system
        files: ^infra/pulumi/event/.*\.go$
        pass_filenames: false
        always_run: false

      - id: gosec-scl-lang
        name: Gosec Security Scanner (SCL Lang)
        entry: bash -c 'cd projects/scl/lang && gosec -exclude-dir=vendor -exclude-generated ./... 2>/dev/null || echo "No Go files to scan"'
        language: system
        files: ^projects/scl/lang/.*\.go$
        pass_filenames: false
        always_run: false

      - id: gosec-app-one
        name: Gosec Security Scanner (App One)
        entry: bash -c 'cd projects/event-driven/app-one && gosec -exclude-dir=vendor -exclude-generated ./... 2>/dev/null || echo "No Go files to scan"'
        language: system
        files: ^projects/event-driven/app-one/.*\.go$
        pass_filenames: false
        always_run: false

      - id: gosec-app-two
        name: Gosec Security Scanner (App Two)
        entry: bash -c 'cd projects/event-driven/app-two && gosec -exclude-dir=vendor -exclude-generated ./... 2>/dev/null || echo "No Go files to scan"'
        language: system
        files: ^projects/event-driven/app-two/.*\.go$
        pass_filenames: false
        always_run: false

      - id: gosec-app-three
        name: Gosec Security Scanner (App Three)
        entry: bash -c 'cd projects/event-driven/app-three && gosec -exclude-dir=vendor -exclude-generated ./... 2>/dev/null || echo "No Go files to scan"'
        language: system
        files: ^projects/event-driven/app-three/.*\.go$
        pass_filenames: false
        always_run: false

      - id: gosec-docker-log-agent
        name: Gosec Security Scanner (Docker Log Agent)
        entry: bash -c 'cd projects/docker-log-agent && gosec -exclude-dir=vendor -exclude-generated ./... 2>/dev/null || echo "No Go files to scan"'
        language: system
        files: ^projects/docker-log-agent/.*\.go$
        pass_filenames: false
        always_run: false

  # Go formatting
  - repo: local
    hooks:
      - id: go-fmt-pulumi-event
        name: Go Format (Pulumi Event)
        entry: bash -c 'cd infra/pulumi/event && go fmt ./...'
        language: system
        files: ^infra/pulumi/event/.*\.go$
        pass_filenames: false

      - id: go-fmt-scl-lang
        name: Go Format (SCL Lang)
        entry: bash -c 'cd projects/scl/lang && go fmt ./...'
        language: system
        files: ^projects/scl/lang/.*\.go$
        pass_filenames: false

      - id: go-fmt-app-one
        name: Go Format (App One)
        entry: bash -c 'cd projects/event-driven/app-one && go fmt ./...'
        language: system
        files: ^projects/event-driven/app-one/.*\.go$
        pass_filenames: false

      - id: go-fmt-app-two
        name: Go Format (App Two)
        entry: bash -c 'cd projects/event-driven/app-two && go fmt ./...'
        language: system
        files: ^projects/event-driven/app-two/.*\.go$
        pass_filenames: false

      - id: go-fmt-app-three
        name: Go Format (App Three)
        entry: bash -c 'cd projects/event-driven/app-three && go fmt ./...'
        language: system
        files: ^projects/event-driven/app-three/.*\.go$
        pass_filenames: false

      - id: go-fmt-docker-log-agent
        name: Go Format (Docker Log Agent)
        entry: bash -c 'cd projects/docker-log-agent && go fmt ./...'
        language: system
        files: ^projects/docker-log-agent/.*\.go$
        pass_filenames: false